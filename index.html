<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Hiko Amane&#39;s blog
  
</title>

<meta name="keywords" content="Progamming, Architecting">
<meta property="og:type" content="website">
<meta property="og:title" content="Hiko Amane&#39;s blog">
<meta property="og:url" content="https://Ys-Zhou.github.io/index.html">
<meta property="og:site_name" content="Hiko Amane&#39;s blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hiko Amane&#39;s blog">


  <link rel="alternative" href="/atom.xml" title="Hiko Amane&#39;s blog" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">
<link rel="stylesheet" href="/styles/main.css">






</head>
<body class="monochrome">
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">Hiko Amane&#39;s blog</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">Hiko Amane&#39;s blog</a></h1>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">Yan Zhou</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/"><img src="/images/github.jpg"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWS/">AWS</a><span class="category-list-count">3</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/">Big Data</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SA/">SA</a><span class="tag-list-count">2</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">3</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Yan Zhou">Yan Zhou</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/Ys-Zhou" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/07/14/Collection-Moving-data-into-AWS/">
  Collection: Moving data into AWS
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/07/14/Collection-Moving-data-into-AWS/"><span class="article-date">
  2019-07-14
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/AWS/">AWS</a></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Big-Data/">Big Data</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <ul>
<li><a href="#Kinesis">Kinesis</a></li>
<li><a href="#Kinesis-Data-Streams">Kinesis Data Streams</a><ul>
<li><a href="#Key-Concepts">Key Concepts</a><ul>
<li><a href="#Shards">Shards</a></li>
<li><a href="#Records">Records</a></li>
<li><a href="#Limits">Limits</a></li>
</ul>
</li>
<li><a href="#Kinesis-Producers">Kinesis Producers</a><ul>
<li><a href="#Kinesis-Producer-SDK">Kinesis Producer SDK</a><ul>
<li><a href="#Solutions-for-ProvisionedThroughputExceeded-Exceptions">Solutions for <em>ProvisionedThroughputExceeded</em> Exceptions</a></li>
</ul>
</li>
<li><a href="#Managed-AWS-Sources">Managed AWS Sources</a></li>
<li><a href="#Kinesis-Producer-Library-KPL">Kinesis Producer Library (KPL)</a></li>
<li><a href="#Kinesis-Agent">Kinesis Agent</a></li>
</ul>
</li>
<li><a href="#Kinesis-Consumers-Classic">Kinesis Consumers Classic</a><ul>
<li><a href="#Kinesis-Consumer-SDK">Kinesis Consumer SDK</a></li>
<li><a href="#Kinesis-Client-Library-KCL">Kinesis Client Library (KCL)</a></li>
<li><a href="#Kinesis-Connector-Library">Kinesis Connector Library</a></li>
<li><a href="#AWS-Lambda-Sourcing-from-Kinesis">AWS Lambda Sourcing from Kinesis</a></li>
</ul>
</li>
<li><a href="#Kinesis-Enhanced-Fan-Out">Kinesis Enhanced Fan-Out</a><ul>
<li><a href="#Enhanced-Fan-Out-vs-Standard-Consumers">Enhanced Fan-Out vs Standard Consumers</a></li>
</ul>
</li>
<li><a href="#Kinesis-Scaling">Kinesis Scaling</a><ul>
<li><a href="#Shard-Splitting">Shard Splitting</a></li>
<li><a href="#Shard-Merging">Shard Merging</a></li>
<li><a href="#No-Native-Auto-Scaling">No Native Auto Scaling</a></li>
<li><a href="#Limitations">Limitations</a></li>
</ul>
</li>
<li><a href="#Kinesis-Security">Kinesis Security</a></li>
</ul>
</li>
<li><a href="#Kinesis-Data-Firehose">Kinesis Data Firehose</a><ul>
<li><a href="#Delivery-Features">Delivery Features</a></li>
<li><a href="#Buffer-Sizing">Buffer Sizing</a></li>
<li><a href="#Kinesis-Data-Streams-vs-Firehose">Kinesis Data Streams vs Firehose</a></li>
</ul>
</li>
<li><a href="#AWS-SQS">AWS SQS</a><ul>
<li><a href="#SQS-Standard-Queue">SQS - Standard Queue</a></li>
<li><a href="#SQS-FIFO-Queue">SQS - FIFO Queue</a></li>
<li><a href="#Producing-Messages">Producing Messages</a></li>
<li><a href="#Consuming-Messages">Consuming Messages</a></li>
<li><a href="#SQS-Extended-Client">SQS Extended Client</a></li>
<li><a href="#Use-Cases">Use Cases</a></li>
<li><a href="#Pricing">Pricing</a></li>
<li><a href="#Security">Security</a></li>
</ul>
</li>
<li><a href="#AWS-IoT">AWS IoT</a><ul>
<li><a href="#Device-Gateway">Device Gateway</a></li>
<li><a href="#Message-Broker">Message Broker</a><ul>
<li><a href="#Rules-Engine">Rules Engine</a></li>
</ul>
</li>
<li><a href="#Thing-Registry">Thing Registry</a><ul>
<li><a href="#Authentication">Authentication</a></li>
<li><a href="#Authentication-Policies">Authentication Policies</a></li>
</ul>
</li>
<li><a href="#Device-Shadow">Device Shadow</a></li>
<li><a href="#Greengrass">Greengrass</a></li>
</ul>
</li>
<li><a href="#Database-Migration-Service-DMS">Database Migration Service (DMS)</a><ul>
<li><a href="#Sources-and-Targets">Sources and Targets</a></li>
<li><a href="#Schema-Conversion-Tool-SCT">Schema Conversion Tool (SCT)</a></li>
<li><a href="#Different-between-DMS-and-SCT">Different between DMS and SCT</a></li>
</ul>
</li>
<li><a href="#Direct-Connect">Direct Connect</a></li>
<li><a href="#Snowball">Snowball</a><ul>
<li><a href="#Snowball-Edge">Snowball Edge</a></li>
<li><a href="#Snowmobile">Snowmobile</a></li>
</ul>
</li>
</ul>
<h1 id="Kinesis"><a href="#Kinesis" class="headerlink" title="Kinesis"></a>Kinesis</h1><ul>
<li>Kinesis Data Streams<ul>
<li>Low latency streaming ingest at scale</li>
</ul>
</li>
<li>Kinesis Data Analytics<ul>
<li>Perform real-time analytics on streams using SQL</li>
</ul>
</li>
<li>Kinesis Data Firehose<ul>
<li>Load streams into S3, redshift, ElasticSearch and Splunk</li>
</ul>
</li>
</ul>
<h1 id="Kinesis-Data-Streams"><a href="#Kinesis-Data-Streams" class="headerlink" title="Kinesis Data Streams"></a>Kinesis Data Streams</h1><ul>
<li>Streams are divided in ordered Shards</li>
<li>Ability to reprocess / replay data<ul>
<li>Multiple applications can consume the same stream</li>
</ul>
</li>
<li>Real-time processing with scale of throughput</li>
<li>Once data is inserted in Kinesis, it canâ€™t be deleted (data in Kinesis is immutability)</li>
</ul>
<h2 id="Key-Concepts"><a href="#Key-Concepts" class="headerlink" title="Key Concepts"></a>Key Concepts</h2><h3 id="Shards"><a href="#Shards" class="headerlink" title="Shards"></a>Shards</h3><ul>
<li>The number of shards can evolve over time (reshard / merge)</li>
<li>Records are only ordered per shard</li>
<li>Billing is per shard provisioned</li>
</ul>
<h3 id="Records"><a href="#Records" class="headerlink" title="Records"></a>Records</h3><ul>
<li>Data Blob<ul>
<li>Data being sent, serialized as bytes</li>
<li>Up to 1 MB</li>
</ul>
</li>
<li>Record Key<ul>
<li>Helps to group records in Shards (same key in same shard)</li>
<li>Should use highly distributed key to avoid the <em>hot partition</em> problem</li>
</ul>
</li>
<li>Sequence number<ul>
<li>Unique ID for records put in shards</li>
<li>Added by Kinesis after ingestion</li>
</ul>
</li>
</ul>
<h3 id="Limits"><a href="#Limits" class="headerlink" title="Limits"></a>Limits</h3><ul>
<li>Producer<ul>
<li>1MB/s or 1000 records/s at write per <strong>shard</strong></li>
<li><em>ProvisionedThroughputException</em> otherwise</li>
</ul>
</li>
<li>Consumer Classic<ul>
<li>2MB/s at read per <strong>shard</strong> across <strong>all consumers</strong></li>
<li>5 API calls/s per <strong>shard</strong> across <strong>all consumers</strong></li>
</ul>
</li>
<li>Consumer Enhanced Fan-Out<ul>
<li>2MB/s at read per <strong>shard</strong> per <strong>enhanced consumer</strong></li>
<li>No API calls needed</li>
</ul>
</li>
<li>Data Retention<ul>
<li>24 hours by default</li>
<li>Up to 7 days</li>
</ul>
</li>
</ul>
<h2 id="Kinesis-Producers"><a href="#Kinesis-Producers" class="headerlink" title="Kinesis Producers"></a>Kinesis Producers</h2><ul>
<li>Kinesis Producer SDK</li>
<li>Managed AWS sources</li>
<li>Kinesis Producer Library (KPL)</li>
<li>Kinesis Agent</li>
<li>3rd party libraries</li>
</ul>
<h3 id="Kinesis-Producer-SDK"><a href="#Kinesis-Producer-SDK" class="headerlink" title="Kinesis Producer SDK"></a>Kinesis Producer SDK</h3><ul>
<li>PutRecord</li>
<li>PutRecords<ul>
<li>Use batching and increases throughput</li>
</ul>
</li>
</ul>
<h4 id="Solutions-for-ProvisionedThroughputExceeded-Exceptions"><a href="#Solutions-for-ProvisionedThroughputExceeded-Exceptions" class="headerlink" title="Solutions for ProvisionedThroughputExceeded Exceptions"></a>Solutions for <em>ProvisionedThroughputExceeded</em> Exceptions</h4><ul>
<li>Retries with backoff</li>
<li>Increase (scale up) shards</li>
<li>Use highly distributed partition key</li>
</ul>
<h3 id="Managed-AWS-Sources"><a href="#Managed-AWS-Sources" class="headerlink" title="Managed AWS Sources"></a>Managed AWS Sources</h3><ul>
<li>CloudWatch Logs</li>
<li>AWS IoT</li>
<li>Kinesis Data Analytics</li>
</ul>
<h3 id="Kinesis-Producer-Library-KPL"><a href="#Kinesis-Producer-Library-KPL" class="headerlink" title="Kinesis Producer Library (KPL)"></a>Kinesis Producer Library (KPL)</h3><ul>
<li>C++ / Java library</li>
<li>high performance, long-running producers</li>
<li>Automated and configurable <strong>retry</strong> mechanism</li>
<li>Sync or <strong>Async</strong> (better performance) API</li>
<li>Submits metrics to CloudWatch</li>
<li><strong>Batching</strong> (default) - increase throughput, decrease cost<ul>
<li><strong>Collect</strong> records and write to multiple shards in the same PutRecords API call</li>
<li><strong>Aggregate</strong> - but increase latency<ul>
<li>Store multiple records in one record (go over 1000 records/s limit)</li>
<li>Increase payload size and improve throughput (maximize 1MB/s limit)</li>
</ul>
</li>
<li>Configured with <em>RecordMaxBufferedTime</em> (100ms by default)</li>
</ul>
</li>
<li>Limitation<ul>
<li>Do not support auto compression</li>
<li>KPL Records can only be decoded with KCL or special helper library</li>
</ul>
</li>
</ul>
<h3 id="Kinesis-Agent"><a href="#Kinesis-Agent" class="headerlink" title="Kinesis Agent"></a>Kinesis Agent</h3><ul>
<li>Monitor Log files and sends them to Kinesis Data Streams</li>
<li>Only support Linux-based servers</li>
<li>Can write form multiple directories and write to multiple streams</li>
<li>Can route based on directory or log file</li>
<li>Can pre-process data before sending to streams (single line, json, etc.)</li>
<li>Handles file rotation, checkpointing and retry</li>
<li>Can emit metrics to CloudWatch</li>
</ul>
<h2 id="Kinesis-Consumers-Classic"><a href="#Kinesis-Consumers-Classic" class="headerlink" title="Kinesis Consumers Classic"></a>Kinesis Consumers Classic</h2><ul>
<li>Kinesis Consumer SDK</li>
<li>Kinesis Client Library (KCL)</li>
<li>Kinesis Connector Library</li>
<li>3rd party libraries (Spark, etc.)</li>
<li>Managed AWS sources<ul>
<li>Kinesis Firehose</li>
<li>AWS Lambda</li>
</ul>
</li>
</ul>
<h3 id="Kinesis-Consumer-SDK"><a href="#Kinesis-Consumer-SDK" class="headerlink" title="Kinesis Consumer SDK"></a>Kinesis Consumer SDK</h3><ul>
<li>GetRecords<ul>
<li>Returns up to 10MB of data (then throttle for 5s) or up to 10,000 records<ul>
<li><strong>Maximum of 2MB/s at read per shard</strong></li>
<li><strong>Maximum of 5 GetRecords API calls/s per shard (200ms latency)</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Kinesis-Client-Library-KCL"><a href="#Kinesis-Client-Library-KCL" class="headerlink" title="Kinesis Client Library (KCL)"></a>Kinesis Client Library (KCL)</h3><ul>
<li>Support Java, etc.</li>
<li>Read records from Kinesis produced with the KPL (de-aggregation)</li>
<li><strong>Shard discovery</strong>: share multiple shards with multiple consumers in one group</li>
<li><strong>Checkpointing</strong>: resume progress</li>
<li><strong>Leverages DynamoDB for coordination and checkpointing</strong><ul>
<li>Use provisioned DynamoDB with enough WCU and RCU</li>
<li>Use On-Demand DynamoDB</li>
<li>Otherwise DynamoDB may slow down KCL</li>
</ul>
</li>
</ul>
<h3 id="Kinesis-Connector-Library"><a href="#Kinesis-Connector-Library" class="headerlink" title="Kinesis Connector Library"></a>Kinesis Connector Library</h3><ul>
<li>Have been deprecated</li>
<li>Can only be running on EC2</li>
<li>Write data to S3, DynamoDB, Redshift, ElasticSearch</li>
<li>Can be replaced by Kinesis Firehose or Lambda</li>
</ul>
<h3 id="AWS-Lambda-Sourcing-from-Kinesis"><a href="#AWS-Lambda-Sourcing-from-Kinesis" class="headerlink" title="AWS Lambda Sourcing from Kinesis"></a>AWS Lambda Sourcing from Kinesis</h3><ul>
<li>Lambda consumer has a library to de-aggregate record from the KPL</li>
<li>Lambda can be used to rum lightweight ETL to anywhere you want</li>
<li>Lambda can be used to trigger notifications or send emails in real time</li>
<li>Lambda has a configurable batch size to regulate throughput</li>
</ul>
<h2 id="Kinesis-Enhanced-Fan-Out"><a href="#Kinesis-Enhanced-Fan-Out" class="headerlink" title="Kinesis Enhanced Fan-Out"></a>Kinesis Enhanced Fan-Out</h2><ul>
<li>Kinesis <strong>pushes</strong> data to consumers over HTTP/2 </li>
<li><strong>Each Consumer</strong> get 2 MB/s of providioned through per shard<ul>
<li>No more 2MB/s limit by adding Consumers</li>
<li>Reducy latency (~70ms)</li>
</ul>
</li>
</ul>
<h3 id="Enhanced-Fan-Out-vs-Standard-Consumers"><a href="#Enhanced-Fan-Out-vs-Standard-Consumers" class="headerlink" title="Enhanced Fan-Out vs Standard Consumers"></a>Enhanced Fan-Out vs Standard Consumers</h3><table>
<thead>
<tr>
<th>Enhanced Fan-Out</th>
<th>Standard Consumers</th>
</tr>
</thead>
<tbody><tr>
<td>Low number of consuming applications</td>
<td>Multiple Consumer applications for the same Stream</td>
</tr>
<tr>
<td>Can tolerate ~200 ms latency</td>
<td>Low latency requirements ~70 ms</td>
</tr>
<tr>
<td>Minimize cost</td>
<td>Higher costs (Soft limit of 5 consumers using enhanced fan-out per data stream)</td>
</tr>
</tbody></table>
<h2 id="Kinesis-Scaling"><a href="#Kinesis-Scaling" class="headerlink" title="Kinesis Scaling"></a>Kinesis Scaling</h2><h3 id="Shard-Splitting"><a href="#Shard-Splitting" class="headerlink" title="Shard Splitting"></a>Shard Splitting</h3><ul>
<li>Can be used to increase the Stream capacity (1MB/s per shard)</li>
<li>Can be used to divided a <em>hot shard</em></li>
<li>The old shard is closed and deleted based on data expiration</li>
</ul>
<h3 id="Shard-Merging"><a href="#Shard-Merging" class="headerlink" title="Shard Merging"></a>Shard Merging</h3><ul>
<li>Decrease the Stream capacity and save costs</li>
<li>Group two shards with low traffic</li>
<li>Old shards are closed and deleted based on data expiration</li>
</ul>
<h3 id="No-Native-Auto-Scaling"><a href="#No-Native-Auto-Scaling" class="headerlink" title="No Native Auto Scaling"></a>No Native Auto Scaling</h3><ul>
<li>Can implement Auto Scaling with AWS Lambda</li>
<li>The API call to change the number of shards is <em>UpdateShardCount</em></li>
</ul>
<h3 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h3><ul>
<li>Resharding cannot be done in parallel (have to plan capacity in advance)</li>
<li>Can only perform one resharding at a time and it takes a few seconds<ul>
<li>Double 1000 shards takes about 8.3 hours</li>
</ul>
</li>
</ul>
<h2 id="Kinesis-Security"><a href="#Kinesis-Security" class="headerlink" title="Kinesis Security"></a>Kinesis Security</h2><ul>
<li>Control access / autorization using IAM policies</li>
<li>Encryption in transit using HTTPS endpoints</li>
<li>Encryption at rest using KMS</li>
<li>Client side encryption can only be implemented manually</li>
<li>VPC Endpoints is available for Kinesis</li>
</ul>
<h1 id="Kinesis-Data-Firehose"><a href="#Kinesis-Data-Firehose" class="headerlink" title="Kinesis Data Firehose"></a>Kinesis Data Firehose</h1><ul>
<li>Near Real Time (60s latency minimum for non-full batches)</li>
<li>Read data from<ul>
<li>SDK or KPL</li>
<li>Kinesis Agent</li>
<li>Kinesis Data Streams</li>
<li>CloudWatch Logs &amp; Events</li>
<li>IoT rules actions</li>
</ul>
</li>
<li>Load data into<ul>
<li><strong>S3</strong></li>
<li><strong>Redshift</strong></li>
<li><strong>ElasticSearch</strong></li>
<li><strong>Splunk</strong></li>
</ul>
</li>
<li>Spark or KCL <strong>cannot</strong> read from Firehose</li>
<li>Auto scaling</li>
<li>Support Data Conversions<ul>
<li>JSON to Parquet</li>
<li>JSON to ORC (only for S3)</li>
</ul>
</li>
<li>Support Data Transformation through AWS Lambda</li>
<li>Support Support compression (only for S3)<ul>
<li>GZIP, ZIP, Snappy</li>
<li>Only GZIP when data is further loaded into Redshift</li>
</ul>
</li>
<li>Only pay for the amount of data going through Firehose</li>
</ul>
<h2 id="Delivery-Features"><a href="#Delivery-Features" class="headerlink" title="Delivery Features"></a>Delivery Features</h2><ul>
<li>Source Records</li>
<li>Transformation Failures</li>
<li>Delivery Failures</li>
</ul>
<p>can be stored directly into S3</p>
<h2 id="Buffer-Sizing"><a href="#Buffer-Sizing" class="headerlink" title="Buffer Sizing"></a>Buffer Sizing</h2><ul>
<li>When buffer is reached, itâ€™s flushed<ul>
<li>Buffer Size</li>
<li>Buffer Time</li>
</ul>
</li>
<li>Automatically increase the buffer size to increase throughput</li>
<li>High through: more buffer size</li>
<li>Low through: less buffer time</li>
</ul>
<h2 id="Kinesis-Data-Streams-vs-Firehose"><a href="#Kinesis-Data-Streams-vs-Firehose" class="headerlink" title="Kinesis Data Streams vs Firehose"></a>Kinesis Data Streams vs Firehose</h2><table>
<thead>
<tr>
<th>Streams</th>
<th>Firehose</th>
</tr>
</thead>
<tbody><tr>
<td>Custom consumer code</td>
<td>Fully managed, only send to S3, Redshift, ElasticSearch, Splunk</td>
</tr>
<tr>
<td>Real time (~200ms for classic or ~70ms for enhanced fan-out)</td>
<td>Near real time (1min~ buffer time)</td>
</tr>
<tr>
<td>Manual Scaling (shard splitting / merging)</td>
<td>Auto Scaling</td>
</tr>
<tr>
<td>Data Storage for 1 to 7 days</td>
<td>No data storage</td>
</tr>
</tbody></table>
<h1 id="AWS-SQS"><a href="#AWS-SQS" class="headerlink" title="AWS SQS"></a>AWS SQS</h1><h2 id="SQS-Standard-Queue"><a href="#SQS-Standard-Queue" class="headerlink" title="SQS - Standard Queue"></a>SQS - Standard Queue</h2><ul>
<li>Auto Scales without limit</li>
<li>Retention of messages from 1 minute to 14 days, 4 days by default</li>
<li>the number of messages in the queue has no limit</li>
<li>Low latency (~10 ms on publish and receive)</li>
<li>Consumers can be scaled horizontally</li>
<li><strong>Can have duplicate messages</strong></li>
<li><strong>Can have out of order messages</strong></li>
<li><strong>Limitation of 256KB per message</strong></li>
</ul>
<h2 id="SQS-FIFO-Queue"><a href="#SQS-FIFO-Queue" class="headerlink" title="SQS - FIFO Queue"></a>SQS - FIFO Queue</h2><ul>
<li>Name of the queue ends in .fifo</li>
<li>Up to 3,000 messages/s with batching or 300 messages/s without (soft limit)</li>
<li><strong>Messages are sent only once</strong></li>
<li><strong>Messages are processed in order</strong></li>
</ul>
<h2 id="Producing-Messages"><a href="#Producing-Messages" class="headerlink" title="Producing Messages"></a>Producing Messages</h2><ul>
<li>Message body<ul>
<li>String</li>
<li>Up to 256KB</li>
</ul>
</li>
<li>Message attributes (metadata)<ul>
<li>Key-value pair</li>
</ul>
</li>
<li>Delivery delay</li>
<li>Return<ul>
<li>Message ID</li>
<li>MD% hash of the body</li>
</ul>
</li>
</ul>
<h2 id="Consuming-Messages"><a href="#Consuming-Messages" class="headerlink" title="Consuming Messages"></a>Consuming Messages</h2><ul>
<li>Poll messages from SQS <ul>
<li>Up to 10 messages at a time</li>
</ul>
</li>
<li>Process the message within the visibility timeout</li>
<li>Delete the message by message ID &amp; receipt handle</li>
<li>Maximum of 120,000 messages being processed by consumers</li>
</ul>
<h2 id="SQS-Extended-Client"><a href="#SQS-Extended-Client" class="headerlink" title="SQS Extended Client"></a>SQS Extended Client</h2><ul>
<li>Send messages larger than 256KB</li>
<li>Not recommended</li>
<li>Java Library<ul>
<li>Send message to S3 first</li>
<li>Only send metadata to SQS</li>
</ul>
</li>
</ul>
<h2 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h2><ul>
<li>Decouple applications asynchronously</li>
<li>Buffer writes</li>
<li>Handle large loads of messages</li>
</ul>
<h2 id="Pricing"><a href="#Pricing" class="headerlink" title="Pricing"></a>Pricing</h2><ul>
<li>Pay per API request</li>
<li>Pay network usage</li>
</ul>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><ul>
<li>HTTPS endpoints</li>
<li>Server Side Encryption using KMS<ul>
<li>Only encrypts the body</li>
</ul>
</li>
<li>IAM</li>
<li>SQS queue access policy</li>
</ul>
<h1 id="AWS-IoT"><a href="#AWS-IoT" class="headerlink" title="AWS IoT"></a>AWS IoT</h1><h2 id="Device-Gateway"><a href="#Device-Gateway" class="headerlink" title="Device Gateway"></a>Device Gateway</h2><ul>
<li>The entry point for IoT devices connecting to AWS IoT</li>
<li>Supports the MQTT, WebSockets, and HTTP 1.1 protocols</li>
</ul>
<h2 id="Message-Broker"><a href="#Message-Broker" class="headerlink" title="Message Broker"></a>Message Broker</h2><ul>
<li>For devices to communicate with others</li>
<li>Pub/sub messaging pattern with low latency</li>
<li>Supports the MQTT, WebSockets, and HTTP 1.1 protocols</li>
</ul>
<h3 id="Rules-Engine"><a href="#Rules-Engine" class="headerlink" title="Rules Engine"></a>Rules Engine</h3><ul>
<li>Rules are defined on the Broker topics</li>
<li>Rule-action pairs</li>
<li>Used to augment or filter data received from devices</li>
<li>Rules need IAM Roles to perform the actions</li>
</ul>
<h2 id="Thing-Registry"><a href="#Thing-Registry" class="headerlink" title="Thing Registry"></a>Thing Registry</h2><ul>
<li>Represent all connected devices<ul>
<li>A unique ID</li>
<li>Metadata</li>
<li>X.509 certificate</li>
<li>IoT Groups</li>
</ul>
</li>
<li>Can organizes the resources associated with each device</li>
</ul>
<h3 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h3><ul>
<li>Things<ul>
<li>X.509 certificates</li>
<li>AWS SigV4</li>
<li>Custom tokens with custom authorizers</li>
</ul>
</li>
<li>Mobile apps<ul>
<li>Cognito</li>
</ul>
</li>
<li>Web/Desktop/CLI<ul>
<li>IAM</li>
<li>Federated Identities</li>
</ul>
</li>
</ul>
<h3 id="Authentication-Policies"><a href="#Authentication-Policies" class="headerlink" title="Authentication Policies"></a>Authentication Policies</h3><ul>
<li>IoT policies<ul>
<li>Attached to X.509 certificates or Cognito Identities</li>
<li>Can be attached to Groups in stead of Things</li>
</ul>
</li>
<li>IAM policies<ul>
<li>Used for controlling IoT AWS APIs</li>
</ul>
</li>
</ul>
<h2 id="Device-Shadow"><a href="#Device-Shadow" class="headerlink" title="Device Shadow"></a>Device Shadow</h2><ul>
<li>Record the state of Things and synchronize the state when Things back up online</li>
<li>JSON document</li>
</ul>
<h2 id="Greengrass"><a href="#Greengrass" class="headerlink" title="Greengrass"></a>Greengrass</h2><ul>
<li>Brings the compute layer to the devices locally</li>
<li>Execute AWS Lambda on the devices and operate offline</li>
<li>Deploy functions from the cloud</li>
</ul>
<h1 id="Database-Migration-Service-DMS"><a href="#Database-Migration-Service-DMS" class="headerlink" title="Database Migration Service (DMS)"></a>Database Migration Service (DMS)</h1><ul>
<li>Migrate databases to AWS</li>
<li>The source database remains available during the migration</li>
<li>Must run an EC2 instance to perform Continuous Data Replication task using Change Data Capture (CDC)</li>
</ul>
<h2 id="Sources-and-Targets"><a href="#Sources-and-Targets" class="headerlink" title="Sources and Targets"></a>Sources and Targets</h2><ul>
<li>Sources<ul>
<li>On-Premise or EC2 instances databases</li>
<li>RDS</li>
<li>S3</li>
</ul>
</li>
<li>Targets<ul>
<li>On-Premise or EC2 instances databases</li>
<li>RDS, Redshift, DynamoDB</li>
<li>S3</li>
<li>ElasticSearch, Kinesis Data Streams, DocumentDB</li>
</ul>
</li>
</ul>
<h2 id="Schema-Conversion-Tool-SCT"><a href="#Schema-Conversion-Tool-SCT" class="headerlink" title="Schema Conversion Tool (SCT)"></a>Schema Conversion Tool (SCT)</h2><ul>
<li>A tool to convert database schema from one to another</li>
<li>Can use SCT to create DMS endpoints and tasks</li>
</ul>
<h2 id="Different-between-DMS-and-SCT"><a href="#Different-between-DMS-and-SCT" class="headerlink" title="Different between DMS and SCT"></a>Different between DMS and SCT</h2><table>
<thead>
<tr>
<th>DMS</th>
<th>SCT</th>
</tr>
</thead>
<tbody><tr>
<td>Migrate smaller relational workloads (&lt;10 TB) and MongoDB</td>
<td>Migrate large data warehouse workloads</td>
</tr>
<tr>
<td>Support ongoing replication to keep the target in sync</td>
<td>Do not support</td>
</tr>
</tbody></table>
<h1 id="Direct-Connect"><a href="#Direct-Connect" class="headerlink" title="Direct Connect"></a>Direct Connect</h1><ul>
<li>Provides a dedicated private connection from a remote network to your public resources or VPCs<ul>
<li>Need a Virtual Private Gateway on your VPC</li>
</ul>
</li>
<li>Can setup multiple 1 Gbps or 10 Gbps connections</li>
<li>Connect to Direct Connect endpoint in Direct Connect location</li>
<li>Use Cases<ul>
<li>Increase bandwidth throughput</li>
<li>Real-time data feeds</li>
<li>Hybrid Environment</li>
<li>Enhanced security using private connection</li>
</ul>
</li>
<li>Use two Direct Connect as a failover</li>
<li>Use Direct Connect Gateway if you want to connect to VPCs in different regions</li>
</ul>
<h1 id="Snowball"><a href="#Snowball" class="headerlink" title="Snowball"></a>Snowball</h1><ul>
<li>Physical device to move TBs to PBs of data in or out of AWS</li>
<li>Secure by using KMS 256 bit encryption</li>
<li>Use Snowball if it takes more than a week to transfer over the network</li>
</ul>
<h2 id="Snowball-Edge"><a href="#Snowball-Edge" class="headerlink" title="Snowball Edge"></a>Snowball Edge</h2><ul>
<li>More capacity (100 TB) with computational capability<ul>
<li>Storage optimized</li>
<li>Compute optimized</li>
</ul>
</li>
<li>Can pre-process the data while moving<ul>
<li>Support EC2 AMI</li>
<li>Support Lambda functions</li>
</ul>
</li>
</ul>
<h2 id="Snowmobile"><a href="#Snowmobile" class="headerlink" title="Snowmobile"></a>Snowmobile</h2><ul>
<li>100 PB of capacity</li>
<li>Batter than Snowball if more than 10 PB</li>
</ul>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/06/16/Basic-AWS-Best-Practices/">
  Basic AWS Best Practices
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/06/16/Basic-AWS-Best-Practices/"><span class="article-date">
  2019-06-16
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/AWS/">AWS</a></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SA/">SA</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h2 id="Three-ways-to-deploy-applications-to-the-cloud"><a href="#Three-ways-to-deploy-applications-to-the-cloud" class="headerlink" title="Three ways to deploy applications to the cloud"></a>Three ways to deploy applications to the cloud</h2><ul>
<li>Life and shift</li>
<li>Cloud optimized</li>
<li>Cloud native architecture</li>
</ul>
<h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><h3 id="1-Design-for-Failures"><a href="#1-Design-for-Failures" class="headerlink" title="1. Design for Failures"></a>1. Design for Failures</h3><ul>
<li>Use multi-AZ</li>
<li>Use ELB</li>
<li>Use EIP</li>
<li>Do real-time monitoring with CloudWatch</li>
<li>Use SNS for real-time alarms based on CloudWatch metrics</li>
<li>Create database slaves across AZs</li>
</ul>
<h3 id="2-Build-Security-in-Every-Layer"><a href="#2-Build-Security-in-Every-Layer" class="headerlink" title="2. Build Security in Every Layer"></a>2. Build Security in Every Layer</h3><ul>
<li>Encrypt data in transit and at rest</li>
<li>Use KMS</li>
<li>Least privilege with IAM</li>
<li>Use MFA</li>
<li>Use Security groups and NACLs</li>
</ul>
<h3 id="3-Leverage-Multiple-Storage-Options"><a href="#3-Leverage-Multiple-Storage-Options" class="headerlink" title="3. Leverage Multiple Storage Options"></a>3. Leverage Multiple Storage Options</h3><ul>
<li>S3 (Large objects)</li>
<li>Glacier (Achieve data)</li>
<li>CloudFront (Content distribution)</li>
<li>DynamoDB (Simple nonrelational data)</li>
<li>EC2 Ephemeral Storage (Transient data)</li>
<li>EBS (Persistent block storage with snapshots)</li>
<li>RDS &amp; Aurora</li>
<li>Redshift (Data warehouse workloads)</li>
</ul>
<h3 id="4-Implement-Elasticity"><a href="#4-Implement-Elasticity" class="headerlink" title="4. Implement Elasticity"></a>4. Implement Elasticity</h3><ul>
<li>Auto scaling</li>
<li>ELB</li>
<li>DynamoDB (maintain the user state information)</li>
</ul>
<h3 id="5-Think-Parallel"><a href="#5-Think-Parallel" class="headerlink" title="5. Think Parallel"></a>5. Think Parallel</h3><ul>
<li>Use SNS adn SQS</li>
<li>Use multithreading and concurrent requests to the cloud</li>
<li>Run parallel MapReduce jobs (EMR)</li>
<li>Use ELB to distribute load</li>
<li>Use Kinesis for concurrent processing of data</li>
<li>Use Lambda</li>
<li>Use multipart upload adn ranged gets to upload files in S3</li>
</ul>
<h3 id="6-Loosely-Couple-Your-Architecture"><a href="#6-Loosely-Couple-Your-Architecture" class="headerlink" title="6. Loosely Couple Your Architecture"></a>6. Loosely Couple Your Architecture</h3><h3 id="7-There-Are-No-Constraints-in-the-AWS-Cloud"><a href="#7-There-Are-No-Constraints-in-the-AWS-Cloud" class="headerlink" title="7. There Are No Constraints in the AWS Cloud"></a>7. There Are No Constraints in the AWS Cloud</h3>
        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/06/16/Key-points-about-AWS-WAF/">
  Key points about AWS WAF
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/06/16/Key-points-about-AWS-WAF/"><span class="article-date">
  2019-06-16
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/AWS/">AWS</a></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SA/">SA</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="1-Operational-Excellence"><a href="#1-Operational-Excellence" class="headerlink" title="1. Operational Excellence"></a>1. Operational Excellence</h1><h2 id="Design-Principles"><a href="#Design-Principles" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li>Perform operations as code</li>
<li>Document everything</li>
<li>Push small changes instead of big</li>
<li>Refine operating procedures often</li>
<li>Anticipate failure</li>
<li>Learn from the operational failures</li>
</ul>
<h2 id="Areas"><a href="#Areas" class="headerlink" title="Areas"></a>Areas</h2><ul>
<li>Prepare</li>
<li>Operate (CloudWatch logs, ES, Health Dashboard)</li>
<li>Evolve</li>
</ul>
<h1 id="2-Security"><a href="#2-Security" class="headerlink" title="2. Security"></a>2. Security</h1><h2 id="Design-Principles-1"><a href="#Design-Principles-1" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li>Have a strong identity foundation</li>
<li>Enable traceability</li>
<li>Implement security at all layers</li>
<li>Secure the data</li>
<li>Automate for security</li>
<li>Plan for security events</li>
</ul>
<h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><ul>
<li>Use IAM</li>
<li>Use detective controls (Config, Config rule, CloudTrail, CloudWatch, VPC flow logs, Inspector)</li>
<li>Use infrastructure protection</li>
<li>Use data protection<ul>
<li>In transit (HTTPS, SSL/TLS, VPN/IPsec, SSH)</li>
<li>At rest (Encryption)</li>
</ul>
</li>
<li>Use incident response (SQLi, XSS, DDoS)</li>
</ul>
<h1 id="3-Performance-Efficiency"><a href="#3-Performance-Efficiency" class="headerlink" title="3. Performance Efficiency"></a>3. Performance Efficiency</h1><h2 id="Design-Principles-2"><a href="#Design-Principles-2" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li>Go global in a few clicks</li>
<li>Leverage new technologies such as serverless</li>
<li>Consume advanced technology</li>
<li>Leverage multiple technologies</li>
</ul>
<h2 id="Step-1-Selection"><a href="#Step-1-Selection" class="headerlink" title="Step 1: Selection"></a>Step 1: Selection</h2><ul>
<li>Compute (instances, containers, functions)</li>
<li>Storage</li>
<li>Network</li>
<li>Database</li>
</ul>
<h2 id="Step-2-Review"><a href="#Step-2-Review" class="headerlink" title="Step 2: Review"></a>Step 2: Review</h2><ul>
<li>Define your infrastructure as code (CloudFormation)</li>
<li>Use CI/CD</li>
<li>Run benchmarks and do performance tests regularly</li>
</ul>
<h2 id="Step-3-Monitoring"><a href="#Step-3-Monitoring" class="headerlink" title="Step 3: Monitoring"></a>Step 3: Monitoring</h2><h1 id="4-Reliability"><a href="#4-Reliability" class="headerlink" title="4. Reliability"></a>4. Reliability</h1><h2 id="Design-Principles-3"><a href="#Design-Principles-3" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li>Test recovery procedures</li>
<li>Automate recovery from failure</li>
<li>Scale horizontally</li>
<li>Stop guessing capacity</li>
<li>Automate changes to the system</li>
</ul>
<h2 id="Best-Practices-1"><a href="#Best-Practices-1" class="headerlink" title="Best Practices"></a>Best Practices</h2><ul>
<li>Lay the foundation (Also planned well in advance and envision future growth and integration)<ul>
<li>Fault isolation zones</li>
<li>Redundant components</li>
<li>Leveraging managed services</li>
</ul>
</li>
<li>Implement change management<ul>
<li>Blue-green deployments</li>
<li>Canary deployment</li>
<li>Feature toggle</li>
</ul>
</li>
<li>Implement failure management</li>
</ul>
<h1 id="5-Cost-Optimization"><a href="#5-Cost-Optimization" class="headerlink" title="5. Cost Optimization"></a>5. Cost Optimization</h1><h2 id="Design-Principles-4"><a href="#Design-Principles-4" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li>Choose the best consumption model</li>
<li>Use managed services</li>
<li>measure the overall efficiency</li>
<li>Analyze the expenditure</li>
<li>Stop spending on a data center</li>
</ul>
<h2 id="Areas-1"><a href="#Areas-1" class="headerlink" title="Areas"></a>Areas</h2><ul>
<li>Finding cost-effective resources (Using Trusted Advisor)</li>
<li>Matching supply with demand</li>
<li>Being aware of expenditures</li>
<li>Optimizing over time</li>
</ul>

        
      </div>
    </div>

  
    </div>
  






          <div class="main-footer">
  
    Â© 2019 Hiko Amane&#39;s blog - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>
<script src="/scripts/main.js"></script>

</body>
</html>
